<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Football Stadiums Visualization</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.0/echarts.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background-color: #f0f0f0; }
        #chart-container { width: 100vw; height: 100vh; }
    </style>
</head>
<body>
<div id="chart-container"></div>
<script>
    const teamsData = [
        {team: "Manchester United", lat: 53.463060, lon: -2.291332},
        {team: "Newcastle United", lat: 54.975561, lon: -1.621679},
        {team: "Chelsea", lat: 51.481647, lon: -0.190968},
        {team: "Liverpool", lat: 53.430827, lon: -2.960836},
        {team: "AFC Bournemouth", lat: 50.735243, lon: -1.838306},

        {team: "West Ham United", lat: 51.538650, lon: -0.016530},
        {team: "Arsenal", lat: 51.554877, lon: -0.108435},
        {team: "Tottenham Hotspur", lat: 51.603208, lon: -0.065740},
        {team: "Everton", lat: 53.438788, lon: -2.966320},
        {team: "Aston Villa", lat: 52.509089, lon: -1.884788},
        {team: "Manchester City", lat: 53.483137, lon: -2.200395},
        {team: "Blackburn Rovers", lat: 53.728594, lon: -2.489196},
        {team: "Southampton", lat: 50.905435, lon: -1.391183},
        {team: "Leeds United", lat: 53.777829, lon: -1.572155},
        {team: "Middlesbrough", lat: 54.577973, lon: -1.218200},
        {team: "Sunderland", lat: 54.914586, lon: -1.388307},
        {team: "Fulham", lat: 51.474895, lon: -0.221801},
        {team: "Bolton Wanderers", lat: 53.581384, lon: -2.536993},
        {team: "Leicester City", lat: 52.620291, lon: -1.142289},
        {team: "Coventry City", lat: 52.448352, lon: -1.496622},
        {team: "Sheffield Wednesday", lat: 53.411435, lon: -1.500710},
        // {team: "Wimbledon", lat: 51.398310, lon: -0.086575},
        {team: "West Bromwich Albion", lat: 52.509037, lon: -1.963951},
        {team: "Stoke City", lat: 52.988073, lon: -2.176630},
        {team: "Charlton Athletic", lat: 51.486263, lon: 0.036446},
        {team: "Norwich City", lat: 52.621733, lon: 1.310357},
        {team: "Wigan Athletic", lat: 53.547511, lon: -2.653961},
        {team: "Queens Park Rangers", lat: 51.509286, lon: -0.232118},
        {team: "Birmingham City", lat: 52.475654, lon: -1.868036},
        {team: "Crystal Palace", lat: 51.398310, lon: -0.085402},
        {team: "Portsmouth", lat: 50.796358, lon: -1.063770},
        {team: "Derby County", lat: 52.915482, lon: -1.447769},
        {team: "Nottingham Forest", lat: 52.939679, lon: -1.132830},
        {team: "Ipswich Town", lat: 52.054945, lon: 1.145328},
        {team: "Hull City", lat: 53.746167, lon: -0.367508},
        {team: "Wolverhampton Wanderers", lat: 52.590236, lon: -2.130422},
        {team: "Sheffield United", lat: 53.370355, lon: -1.470873},
        {team: "Reading", lat: 51.422386, lon: -0.982654},
        {team: "Watford", lat: 51.649873, lon: -0.401329},
        {team: "Oldham Athletic", lat: 53.555210, lon: -2.128121},
        {team: "Burnley", lat: 53.788987, lon: -2.230198},
        {team: "Bradford City", lat: 53.804418, lon: -1.759326},

        {team: "Blackpool", lat: 53.804910, lon: -3.048109},
        {team: "Barnsley", lat: 53.551740, lon: -1.468189},
        {team: "Swindon Town", lat: 51.564864, lon: -1.771346},
        {team: "Preston North End", lat: 53.772219, lon: -2.688362},
        {team: "Huddersfield Town", lat: 53.654271, lon: -1.768374}
    ].filter(t => t.team !== "Swansea City" && t.team !== "Cardiff City"); // Filter out Welsh teams

    const chartDom = document.getElementById('chart-container');
    const myChart = echarts.init(chartDom);

    fetch("gb.json")
        .then(response => response.json())
        .then(geoData => {
            // IDs of districts in Scotland, Wales, and Northern Ireland to exclude
            const nonEnglishIds = new Set([
                // Scotland
                "GBABD", "GBABE", "GBAGB", "GBANS", "GBCLK", "GBDGY", "GBDND", "GBEAY", "GBEDH", "GBEDU", 
                "GBELN", "GBELS", "GBFAL", "GBFIF", "GBGLG", "GBHLD", "GBIVC", "GBMLN", "GBMRY", "GBNAY", 
                "GBNLK", "GBORK", "GBPKN", "GBRFW", "GBSAY", "GBSCB", "GBSLK", "GBSTG", "GBWDU", "GBWLN", 
                "GBZET","GBERW",
                // Wales
                "GBAGY", "GBBGE", "GBBGW", "GBCAY", "GBCGN", "GBCMN", "GBCRF", "GBCWY", "GBDEN", "GBFLN", 
                "GBGWN", "GBMON", "GBMTY", "GBNTL", "GBNWP", "GBPEM", "GBPOW", "GBRCT", "GBSWA", "GBTOF", 
                "GBVGL", "GBWRX",
                // Northern Ireland
                "GBANT", "GBARD", "GBARM", "GBBLA", "GBBLY", "GBBNB", "GBBFS", "GBCKF", "GBCSR", "GBCKT", 
                "GBCLR", "GBCGV", "GBDGN", "GBDOW", "GBDRY", "GBFER", "GBLMV", "GBLRN", "GBLSB", "GBMFT", 
                "GBMYL", "GBNDN", "GBNTA", "GBNYM", "GBOMH", "GBSTB"
            ]);

            geoData.features = geoData.features.filter(feature => !nonEnglishIds.has(feature.properties.id));

            echarts.registerMap('UK', geoData);

            // 根据缩放级别动态生成数据，控制标签显示数量
            function getSeriesData(zoom) {
                let limit;
                if (zoom < 2) {
                    limit = 5; // 缩放很小时，只显示前5个
                } else if (zoom < 4) {
                    limit = 15; // 中等缩放时，显示前20个
                } else {
                    limit = teamsData.length; // 放大后显示全部
                }

                return teamsData.map((item, index) => ({
                    name: item.team,
                    value: [item.lon, item.lat],
                    label: {
                        show: index < limit // 只有在前 limit 个球队中才显示标签
                    }
                }));
            }

            const option = {
                backgroundColor: '#f0f0f0',
                geo: {
                    map: 'UK',
                    roam: true,
                    label: {
                        show: false, // 初始不显示地区名称，防止太挤
                        color: '#999',
                        fontSize: 8
                    },
                    itemStyle: {
                        areaColor: '#e0e0e0',
                        borderColor: '#fff',
                        borderWidth: 0.5
                    },
                    emphasis: {
                        itemStyle: {
                            areaColor: '#bbb'
                        },
                        label: {
                            show: true,
                            color: '#000'
                        }
                    }
                },
                series: [
                    {
                        name: 'Stadiums',
                        type: 'scatter',
                        coordinateSystem: 'geo',
                        data: getSeriesData(1), // 初始数据，假设默认缩放为1
                        symbolSize: 5,
                        itemStyle: {
                            color: 'red',
                            borderColor: '#fff',
                            borderWidth: 1
                        },
                        label: {
                            show: true,
                            formatter: '{b}',
                            position: 'top',
                            color: '#333',
                            fontSize: 7,
                            textBorderColor: '#fff',
                            textBorderWidth: 2
                        },
                        emphasis: {
                            scale: true
                        }
                    }
                ],
                tooltip: {
                    trigger: 'item',
                    formatter: '{b}'
                }
            };

            myChart.setOption(option);

            // 监听地图漫游（缩放/平移）事件
            myChart.on('georoam', function () {
                // 获取当前缩放级别
                const zoom = myChart.getModel().getComponent('geo').coordinateSystem.getZoom();
                // 更新数据以显示/隐藏标签
                myChart.setOption({
                    geo: {
                        label: {
                            show: zoom > 5 // 当缩放大于3时显示地区名称
                        }
                    },
                    series: [{
                        data: getSeriesData(zoom)
                    }]
                });
                console.log('Current Zoom Level:', zoom);
            });

            myChart.on('click', function(params) {
                if (params.componentType === 'series') {
                    window.location.href = params.name.replace(/\s+/g, '') + ".html";
                }
            });
        });

    window.addEventListener('resize', myChart.resize);
</script>
</body>
</html>
