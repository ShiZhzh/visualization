<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Football Stadiums Visualization</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.0/echarts.min.js"></script>
    <script src="data.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
<img id="pl-logo" src="./image/pl_white.png" alt="Premier League Logo">
<div id="title">
    通过可视化带你认识“英超”
</div>
<div id="intro-text">
    英格兰足球超级联赛（Premier League），通常简称“英超”，是英格兰足球总会属下的最高等级职业足球联赛。<br>
    作为世界上最受欢迎的体育联赛之一，英超以其快节奏的比赛风格、激烈的竞争环境和顶级的球星阵容闻名于世。<br>
    这里汇聚了曼联、利物浦、阿森纳、切尔西、曼城等豪门俱乐部，每个赛季都上演着扣人心弦的冠军争夺战。<br><br>
    我们的可视化首先实现了“英超地图”，通过地图展示各俱乐部的分布以及基本情况<br>
    随后我们通过多种方法可视化了英超联赛数据，直观展示了各俱乐部特点和联赛发展
</div>
<div id="msg">

</div>
<div id="chart">
    英超地图
</div>
<div id="chart-container"></div>
<script>
    const teamsData = allTeamsData;

    const chartDom = document.getElementById('chart-container');
    const myChart = echarts.init(chartDom);

    fetch("gb.json")
        .then(response => response.json())
        .then(geoData => {
            // IDs of districts in Scotland, Wales, and Northern Ireland to exclude
            const nonEnglishIds = new Set([
                // Scotland
                "GBABD", "GBABE", "GBAGB", "GBANS", "GBCLK", "GBDGY", "GBDND", "GBEAY", "GBEDH", "GBEDU", 
                "GBELN", "GBELS", "GBFAL", "GBFIF", "GBGLG", "GBHLD", "GBIVC", "GBMLN", "GBMRY", "GBNAY", 
                "GBNLK", "GBORK", "GBPKN", "GBRFW", "GBSAY", "GBSCB", "GBSLK", "GBSTG", "GBWDU", "GBWLN", 
                "GBZET","GBERW",
                // Wales
                "GBAGY", "GBBGE", "GBBGW", "GBCAY", "GBCGN", "GBCMN", "GBCRF", "GBCWY", "GBDEN", "GBFLN", 
                "GBGWN", "GBMON", "GBMTY", "GBNTL", "GBNWP", "GBPEM", "GBPOW", "GBRCT", "GBSWA", "GBTOF", 
                "GBVGL", "GBWRX",
                // Northern Ireland
                "GBANT", "GBARD", "GBARM", "GBBLA", "GBBLY", "GBBNB", "GBBFS", "GBCKF", "GBCSR", "GBCKT", 
                "GBCLR", "GBCGV", "GBDGN", "GBDOW", "GBDRY", "GBFER", "GBLMV", "GBLRN", "GBLSB", "GBMFT", 
                "GBMYL", "GBNDN", "GBNTA", "GBNYM", "GBOMH", "GBSTB"
            ]);

            // 定义英格兰9大区的 ID 集合和对应颜色
            const regionConfig = [
                {
                    name: "North East",
                    color: "#87CEEB", // SkyBlue
                    ids: new Set(["GBNBL","GBNET","GBGAT","GBNTY","GBSTY","GBSND","GBDUR","GBDAL","GBHPL","GBSTT","GBRCC","GBMDB"])
                },
                {
                    name: "North West",
                    color: "#4682B4", // SteelBlue
                    ids: new Set(["GBCMA","GBLAN","GBBPL","GBBBD","GBBOL","GBBUR","GBMAN","GBOLD","GBROC","GBSAL","GBSKP",
                        "GBTAM","GBTRA","GBWIG","GBKNO","GBLIV","GBSEF","GBWIR","GBHAL","GBWRT","GBCHE","GBCWC","GBCHW",
                        "GBTRF","GBSFT","GBKWL","GBSHN","GBWGN","GBSLF","GBRCH",])},
                {
                    name: "Yorkshire and the Humber",
                    color: "#33FF99",
                    ids: new Set(["GBNYK","GBYOR","GBERY","GBKHU","GBBRD","GBCLD","GBKIR","GBLDS","GBWKF","GBBNS","GBDNC",
                        "GBROT","GBSHF","GBNLN","GBNEL","GBKHL",])
                },
                {
                    name: "East Midlands",
                    color: "#FFD700", // Gold
                    ids: new Set(["GBDBY","GBDER","GBNTT","GBNGM","GBLIN","GBLEC","GBLCE","GBRUT","GBNTH","GBNNH","GBWNH"])
                },
                {
                    name: "West Midlands",
                    color: "#FFA500", // Orange
                    ids: new Set(["GBSTS","GBSTO","GBSHR","GBTEL","GBWAR","GBWOR","GBHEF","GBBIR","GBCOV","GBDUD","GBSAN","GBSOL",
                        "GBWAL","GBWLV","GBWLL","GBSAW","GBTFW","GBSTE",])
                },
                {
                    name: "East of England",
                    color: "#9999FF",
                    ids: new Set(["GBNFK","GBSFK","GBCAM","GBPET","GBESS","GBSOU","GBTHR","GBHRT","GBBDF","GBLUT","GBCEN","GBCBF",
                        "GBPTE","GBSOS",])
                },
                {
                    name: "London",
                    color: "#FF9999", // OrangeRed
                    ids: new Set(["GBLND","GBBKI","GBBNE","GBBEX","GBBRN","GBBRO","GBCRO","GBEAL","GBENF","GBGRE","GBHCK",
                        "GBHMF","GBHRG","GBHRW","GBHAV","GBHIL","GBHNS","GBISL","GBKEC","GBKTT","GBLBH","GBLEW","GBMRT","GBNWM",
                        "GBRDB","GBRIC","GBSWK","GBSUT","GBTOW","GBWFT","GBWND","GBWSM","GBSTN","GBCRY","GBBRY","GBBEN","GBBDG",
                        "GBTWH","GBCMD","GBHRY",])
                },
                {
                    name: "South East",
                    color: "#40E0D0", // Turquoise
                    ids: new Set(["GBBKM","GBMKN","GBOXF","GBSUR","GBWSX","GBESX","GBBHM","GBKEN","GBMDW","GBHAM","GBPOR","GBSOU",
                        "GBIOW","GBBRK","GBBRA","GBREA","GBSLO","GBWNM","GBWIN","GBSTH","GBWBK","GBSRY","GBRDG","GBWOK", "GBBRC",
                        "GBSLG","GBMIK","GBBNH", ])
                },
                {
                    name: "South West",
                    color: "#66B2FF", // DodgerBlue
                    ids: new Set(["GBGLO","GBSGC","GBWIL","GBSWI","GBDOR","GBBOU","GBPOO","GBSOM","GBBAS","GBNSM","GBDEV","GBPLY",
                        "GBTOR","GBCRN","GBIOS","GBTOB","GBBST","GBCON","GBPOL","GBBMH","GBGLS", "GBSWD",  ])
                }
            ];

            geoData.features = geoData.features.filter(feature => !nonEnglishIds.has(feature.properties.id));

            const specialRegions = [];
            const districtToRegionMap = {}; // 新增：用于映射行政区名到大区名

            geoData.features.forEach(feature => {
                // 遍历配置，找到当前 feature 所属的区域
                const region = regionConfig.find(r => r.ids.has(feature.properties.id));
                if (region) {
                    districtToRegionMap[feature.properties.name] = region.name; // 记录映射关系
                    specialRegions.push({
                        name: feature.properties.name,
                        itemStyle: {
                            areaColor: region.color
                        }
                    });
                }
            });

            echarts.registerMap('UK', geoData);

            // 根据缩放级别动态生成数据，控制标签显示数量
            function getSeriesData(zoom) {
                let limit;
                if (zoom < 1.5) {
                    limit = 11; // 缩放很小时，只显示前5个
                } else if (zoom < 2) {
                    limit = 20; // 中等缩放时，显示前20个
                } else {
                    limit = teamsData.length; // 放大后显示全部
                }

                return teamsData.map((item, index) => ({
                    name: item.team,
                    value: [item.lon, item.lat],
                    info: item, // 传递完整信息以便 tooltip 使用
                    label: {
                        show: index < limit // 只有在前 limit 个球队中才显示标签
                    }
                }));
            }

            const option = {
                backgroundColor: 'transparent', // 背景透明，让 CSS drop-shadow 生效
                geo: {
                    map: 'UK',
                    regions: specialRegions,
                    roam: true,
                    label: {
                        show: false, // 初始不显示地区名称，防止太挤
                        color: '#999',
                        fontSize: 16
                    },
                    itemStyle: {
                        areaColor: '#f4f4f4', // 浅灰色区域
                        borderColor: '#fff',
                        borderWidth: 1
                    },
                    emphasis: {
                        itemStyle: {
                            areaColor: '#e0e0e0', // 悬浮颜色加深
                            // 悬浮时可以保留一点微弱的阴影
                            shadowBlur: 5,
                            shadowColor: 'rgba(0,0,0,0.2)'
                        },
                        label: {
                            show: true,
                            color: '#37003c' // 悬浮文字紫色
                        }
                    }
                },
                series: [
                    {
                        name: 'Stadiums',
                        type: 'scatter',
                        coordinateSystem: 'geo',
                        data: getSeriesData(1), // 初始数据，假设默认缩放为1
                        symbolSize: 15,
                        itemStyle: {
                            color: '#ff2882', // 英超粉色点
                            borderColor: '#fff',
                            borderWidth: 2,
                            shadowBlur: 8,
                            shadowColor: 'rgba(0,0,0,0.4)'
                        },
                        label: {
                            show: true,
                            formatter: '{b}',
                            position: 'top',
                            color: '#37003c', // 标签文字紫色
                            fontWeight: 'bold',
                            fontSize: 14,
                            backgroundColor: 'rgba(255,255,255,0.8)', // 标签背景半透明白
                            padding: [4, 8],
                            borderRadius: 4
                        },
                        emphasis: {
                            scale: true,
                            label: {
                                show: true,
                                fontSize: 14,
                            }
                        }
                    }
                ],
                tooltip: {
                    trigger: 'item',
                    enterable: true, // 允许鼠标进入 tooltip
                    formatter: getTooltipFormatter()
                }
            };

            myChart.setOption(option);

            // 监听地图漫游（缩放/平移）事件
            myChart.on('georoam', function () {
                // 获取当前缩放级别
                const zoom = myChart.getModel().getComponent('geo').coordinateSystem.getZoom();
                // 更新数据以显示/隐藏标签
                myChart.setOption({
                    geo: {
                        label: {
                            show: zoom > 2.5 // 当缩放大于3时显示地区名称
                        }
                    },
                    series: [{
                        data: getSeriesData(zoom)
                    }]
                });
                // console.log('Current Zoom Level:', zoom);
            });

            myChart.on('click', function(params) {
                console.log(params.componentType);
                if (params.componentType === 'series') {
                    // 修改跳转路径：进入 team 目录，并将文件名转为小写
                    window.location.href = "./team/" + params.name.replace(/\s+/g, '').toLowerCase() + ".html";
                } else if (params.componentType === 'geo') {
                    // 获取点击的行政区名称
                    const districtName = params.name;
                    // 查找所属的大区
                    const regionName = districtToRegionMap[districtName];
                    
                    if (regionName) {
                        // 跳转到对应大区的页面，例如 "NorthWest.html"
                        window.location.href = "./area/"+regionName.replace(/\s+/g, '') + ".html";
                    }
                }
            });
        });

    window.addEventListener('resize', myChart.resize);
</script>
<div id="data">
    从数据深入分析“英超”
</div>
<div id="radarChart">
    雷达图
</div>
</body>
</html>
