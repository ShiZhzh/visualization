<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>London Region</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.0/echarts.min.js"></script>
    <script src="../data.js"></script>
    <link rel="stylesheet" href="../styles.css">
</head>
<body>
<button class="back-button" onclick="window.location.href='../main.html#chart'">Back to UK Map</button>
<div id="subchart-container"></div>
<script>
    // London Teams
    const regionTeams = new Set(["Chelsea", "West Ham United", "Arsenal", "Tottenham Hotspur", "Fulham", "Crystal Palace"]);
    const teamsData = allTeamsData.filter(t => regionTeams.has(t.team));

    const chartDom = document.getElementById('subchart-container');
    const myChart = echarts.init(chartDom);

    fetch("../gb.json")
        .then(response => response.json())
        .then(geoData => {
            // London District IDs (Copied from main.html)
            const regionIds = new Set(["GBLND","GBBKI","GBBNE","GBBEX","GBBRN","GBBRO","GBCRO","GBEAL","GBENF","GBGRE","GBHCK",
                "GBHMF","GBHRG","GBHRW","GBHAV","GBHIL","GBHNS","GBISL","GBKEC","GBKTT","GBLBH","GBLEW","GBMRT","GBNWM",
                "GBRDB","GBRIC","GBSWK","GBSUT","GBTOW","GBWFT","GBWND","GBWSM","GBSTN","GBCRY","GBBRY","GBBEN","GBBDG",
                "GBTWH","GBCMD","GBHRY"]);

            // Filter map data for this region
            geoData.features = geoData.features.filter(feature => regionIds.has(feature.properties.id));

            echarts.registerMap('London', geoData);

            const option = {
                backgroundColor: 'transparent',
                title: { text: 'London', left: 'center', top: 20 },
                geo: {
                    map: 'London',
                    roam: true,
                    label: { show: true, color: '#777', fontSize: 16 },
                    itemStyle: {
                        areaColor: '#FF9999', // OrangeRed
                        borderColor: '#fff',
                        borderWidth: 1,
                        shadowBlur: 5,
                        shadowColor: 'rgba(0,0,0,0.2)'
                    },
                    emphasis: {
                        itemStyle: { areaColor: '#FF6347' },
                        label: { show: true, color: '#000' }
                    }
                },
                series: [
                    {
                        name: 'Stadiums',
                        type: 'scatter',
                        coordinateSystem: 'geo',
                        data: teamsData.map(item => ({
                            name: item.team,
                            value: [item.lon, item.lat],
                            info: item
                        })),
                        symbolSize: 10,
                        itemStyle: { color: 'red', borderColor: '#fff', borderWidth: 1 },
                        label: {
                            show: true, formatter: '{b}', position: 'right',
                            color: '#000', fontSize: 16, backgroundColor: 'rgba(255,255,255,1)', padding: [2, 4]
                        },
                        emphasis: { scale: true }
                    }
                ],
                tooltip: { 
                    trigger: 'item', 
                    enterable: true,
                    formatter: getTooltipFormatter() 
                }
            };

            myChart.setOption(option);

            myChart.on('click', function(params) {
                if (params.componentType === 'series') {
                    // 修改跳转路径：进入 team 目录，并将文件名转为小写
                    window.location.href = "../team/" + params.name.replace(/\s+/g, '').toLowerCase() + ".html";
                }
            });
        });

    window.addEventListener('resize', myChart.resize);
</script>
</body>
</html>
